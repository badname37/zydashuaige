<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026冬令营 · 敢于与众不同</title>
<style>
body { font-family:"Microsoft Yahei",sans-serif; background:#0b1736; color:#fff; margin:0; padding:0; }
header { text-align:center; padding:30px 10px; background:#142857; }
header h1 { margin:0; font-size:2em; }
header p { margin:5px 0; color:#a9c4ff; }
.container { max-width:900px; margin:0 auto; padding:20px; }
section { background-color:#1b2c52; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 0 10px rgba(255,255,255,0.05); }
h2 { border-bottom:2px solid #3f64b5; padding-bottom:5px; margin-bottom:15px; }
table { border-collapse:collapse; width:100%; }
th, td { border:1px solid #324a7a; padding:8px; text-align:center; min-width:80px; }
th { background-color:#223a70; cursor:pointer; }
input[type=number], input[type=text] { width:100%; text-align:center; border-radius:5px; border:none; padding:4px; background:#1b2c52; color:#fff; }
.button { background-color:#3f64b5; color:white; padding:8px 15px; border:none; border-radius:8px; cursor:pointer; margin-top:10px; }
.button:hover { background-color:#5c81e0; }
.admin-panel { text-align:right; margin-bottom:10px; }
#passwordInput, #announcementInput { padding:5px; border-radius:6px; border:none; margin-right:5px; }
.nav-buttons { margin-bottom:20px; text-align:center; }
.nav-buttons .button { margin:0 5px; }
.hidden { display:none; }
#announcementBox { background:#3f64b5; padding:10px; border-radius:6px; word-break: break-word; }
#detailsSection { overflow-x:auto; }
#detailsTable { min-width:800px; table-layout:auto; border-collapse: collapse; }
#detailsTable th:first-child,#detailsTable td:first-child{
  position: sticky;
  left:0;
  background:#223a70;
  z-index:1;
}
#detailsTable th:last-child,#detailsTable td:last-child{
  position: static; /* 不再 sticky，避免手机端霸占中间 */
  background:#223a70;
}
</style>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
</head>
<body>

<header>
<h1>2026冬令营 · 敢于与众不同</h1>
<p>Winter Camp 2026 — Dare to be Different</p>
</header>

<div class="container">
<div class="admin-panel">
<span id="statusText">🔒 当前为查看模式</span>
<input type="password" id="passwordInput" placeholder="输入管理员密码">
<button class="button" onclick="login()">登录</button>
<button class="button" onclick="logout()">退出</button>
<button class="button" onclick="downloadJSON()">📥 下载 data.json</button>
</div>

<div class="nav-buttons">
<button class="button" onclick="showSection('home')">🏠 首页</button>
<button class="button" onclick="showSection('details')">📋 积分详细记录</button>
</div>

<section id="homeSection">
  <h2>📣 公告栏</h2>
  <div id="announcementBox"></div>
  <div id="announcementEditor" style="margin-top:10px; display:none;">
    <input id="announcementInput" type="text" placeholder="编辑公告内容">
    <button class="button" onclick="saveAnnouncement()">💾 保存公告</button>
  </div>

  <h2>📅 时间表</h2>
  <table>
    <tr><th>日期</th><th>时间</th><th>活动内容</th></tr>
    <tr><td>Day 1</td><td>09:00 - 12:00</td><td>破冰游戏 & 小组介绍</td></tr>
    <tr><td>Day 1</td><td>14:00 - 17:00</td><td>团队挑战赛</td></tr>
    <tr><td>Day 2</td><td>09:30 - 11:30</td><td>主题工作坊</td></tr>
    <tr><td>Day 2</td><td>15:00 - 17:00</td><td>创造力竞赛</td></tr>
    <tr><td>Day 3</td><td>09:00 - 11:00</td><td>圣经密室逃脱</td></tr>
    <tr><td>Day 3</td><td>14:00 - 16:30</td><td>总结 & 分享会</td></tr>
  </table>

  <h2>⚠️ 注意事项</h2>
  <ul>
    <li>请遵守营会时间与规则，准时参加活动。</li>
    <li>保持整洁，不乱扔垃圾。</li>
    <li>彼此尊重、互相关心，共同营造温暖氛围。</li>
  </ul>

  <h2>🏆 积分榜</h2>
  <table id="scoreTable">
    <tr><th>组别</th><th>积分</th></tr>
  </table>
  <button class="button" id="saveScoreBtn" onclick="saveScores()" style="display:none;">💾 保存积分</button>
</section>

<section id="detailsSection" class="hidden">
  <table id="detailsTable"></table>
  <div style="margin-top:10px;" id="detailsAdminBtns" class="hidden">
    <button class="button" onclick="addRow()">➕ 添加行</button>
    <button class="button" onclick="addColumn()">➕ 添加列</button>
  </div>
  <button class="button" id="saveDetailsBtn" onclick="saveDetails()" style="display:none;">💾 保存详细记录</button>
</section>

<script>
const PASSWORD = "2026";
let isAdmin = false;
const groups = ["第一组","第二组","第三组","第四组","第五组","第六组","第七组","第八组","第九组"];
let data = { announcement:"", scores:{}, details:[] };

// GitHub 上 data.json 地址（替换成你的仓库）
const GITHUB_JSON_URL = "https://raw.githubusercontent.com/你的用户名/你的仓库名/main/data.json";

// 显示/隐藏
function showSection(section){
  document.getElementById('homeSection').classList.add('hidden');
  document.getElementById('detailsSection').classList.add('hidden');
  document.getElementById(section+'Section').classList.remove('hidden');
}

// 加载默认数据
function loadDefaultData(){
  groups.forEach(g=>{
    if(!(g in data.scores)) data.scores[g]=0;
  });
  if(data.details.length===0){
    data.details = groups.map(g=>({小组:g}));
  }
}

// 公告
function loadAnnouncement(){
  document.getElementById("announcementBox").innerText = data.announcement || "暂无公告";
  if(isAdmin) document.getElementById("announcementInput").value = data.announcement || "";
}
function saveAnnouncement(){
  if(!isAdmin) return alert("管理员模式下才可修改");
  data.announcement = document.getElementById("announcementInput").value;
  saveDataJSON();
  loadAnnouncement();
}

// 积分榜
function loadScores(){
  const table=document.getElementById("scoreTable");
  table.innerHTML="<tr><th>组别</th><th>积分</th></tr>";
  groups.forEach(g=>{
    const val = data.scores[g] || 0;
    const row = document.createElement("tr");
    if(isAdmin) row.innerHTML=`<td>${g}</td><td><input id="${g}" type="number" value="${val}"></td>`;
    else row.innerHTML=`<td>${g}</td><td>${val}</td>`;
    table.appendChild(row);
  });
}
function saveScores(){
  if(!isAdmin) return;
  groups.forEach(g=>{
    const inputEl=document.getElementById(g);
    if(inputEl) data.scores[g]=parseInt(inputEl.value)||0;
  });
  saveDataJSON();
  loadScores();
}

// 详细记录
function loadDetails(){
  const table=document.getElementById("detailsTable");
  table.innerHTML="";
  const stored = data.details;

  const header=table.insertRow();
  const cols=Object.keys(stored[0] || {小组:""});
  cols.push("总分");
  cols.forEach(c=>{
    const th=document.createElement("th");
    th.innerText=c;
    if(isAdmin) th.contentEditable="true";
    header.appendChild(th);
  });

  stored.forEach(r=>{
    const row=table.insertRow();
    Object.keys(r).forEach(k=>{
      const cell=row.insertCell();
      cell.innerText=r[k]||"";
      if(isAdmin) cell.contentEditable="true";
    });
    const totalCell=row.insertCell();
    totalCell.innerText=0;
  });
  updateTotalScores();
}

function updateTotalScores(){
  const table=document.getElementById("detailsTable");
  const rows=table.rows;
  if(rows.length<2) return;
  const totalCol=rows[0].cells.length-1;
  for(let i=1;i<rows.length;i++){
    let sum=0;
    for(let j=1;j<totalCol;j++){
      const val=parseInt(rows[i].cells[j].innerText)||0;
      sum+=val;
    }
    rows[i].cells[totalCol].innerText=sum;
    const groupName=rows[i].cells[0].innerText;
    data.scores[groupName]=sum;
  }
  loadScores();
}

// 管理员操作
function addRow(){ if(!isAdmin) return; const table=document.getElementById("detailsTable"); const header=table.rows[0]; const row=table.insertRow(); for(let i=0;i<header.cells.length;i++){ const cell=row.insertCell(); cell.innerText=i===0?"新小组":""; if(isAdmin) cell.contentEditable="true"; } updateTotalScores(); saveDataJSON(); }
function addColumn(){ if(!isAdmin) return; const table=document.getElementById("detailsTable"); const name=prompt("请输入列标题"); if(!name) return; const header=table.rows[0]; const newTh=header.insertCell(header.cells.length-1); newTh.innerText=name; if(isAdmin) newTh.contentEditable="true"; for(let i=1;i<table.rows.length;i++){ const c=table.rows[i].insertCell(table.rows[i].cells.length-1); c.innerText=""; if(isAdmin) c.contentEditable="true"; } updateTotalScores(); saveDataJSON(); }
function saveDetails(){ if(!isAdmin) return; const table=document.getElementById("detailsTable"); const headers=[]; for(let i=0;i<table.rows[0].cells.length-1;i++) headers.push(table.rows[0].cells[i].innerText); const newDetails=[]; for(let i=1;i<table.rows.length;i++){ const rowObj={}; for(let j=0;j<headers.length;j++) rowObj[headers[j]]=table.rows[i].cells[j].innerText; newDetails.push(rowObj); } data.details=newDetails; updateTotalScores(); saveDataJSON(); loadDetails(); }

// 登录登出
function login(){ const input=document.getElementById("passwordInput").value; if(input===PASSWORD){ isAdmin=true; document.getElementById("statusText").innerText="🟢 管理员模式"; document.getElementById("saveScoreBtn").style.display="inline-block"; document.getElementById("saveDetailsBtn").style.display="inline-block"; document.getElementById("announcementEditor").style.display="block"; document.getElementById("detailsAdminBtns").classList.remove("hidden"); loadScores(); loadDetails(); loadAnnouncement(); } else alert("❌ 密码错误！"); }
function logout(){ isAdmin=false; document.getElementById("statusText").innerText="🔒 当前为查看模式"; document.getElementById("saveScoreBtn").style.display="none"; document.getElementById("saveDetailsBtn").style.display="none"; document.getElementById("announcementEditor").style.display="none"; document.getElementById("detailsAdminBtns").classList.add("hidden"); loadScores(); loadDetails(); loadAnnouncement(); }

// 生成 JSON 下载
function downloadJSON(){ saveDataJSON(); }
function saveDataJSON(){ const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="data.json"; a.click(); URL.revokeObjectURL(url); alert("✅ 最新 data.json 已生成，请上传 GitHub 覆盖原文件"); }

// 自动拉取 GitHub 最新数据
async function fetchLatestData(){
  try{
    const response = await fetch(GITHUB_JSON_URL + "?t="+new Date().getTime());
    if(!response.ok) throw new Error("无法获取最新数据");
    const latest = await response.json();
    data = latest;
    loadDefaultData();
    loadAnnouncement();
    loadScores();
    loadDetails();
  } catch(err){ console.log("获取最新 data.json 出错:", err); }
}
setInterval(fetchLatestData,10000);
fetchLatestData();
</script>
</body>
</html>
